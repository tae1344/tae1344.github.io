---
import Layout from '../layouts/Layout.astro';
import ProjectCard from '../components/features/ProjectCard.astro';
import PostCard from '../components/features/PostCard.astro';
import { filePathToSlug, toAbsolutePath, toDate } from '../utils/content';
import mermaid from 'mermaid';

mermaid.initialize({
	startOnLoad: true,
	theme: 'base',
	securityLevel: 'loose',
});

type ProjectItem = {
	slug: string;
	title: string;
	description: string;
	tags: string[];
	thumbnail: string;
	videoUrl?: string;
	date: Date;
	pinned: boolean;
	order?: number;
};

type PostItem = {
	slug: string;
	title: string;
	excerpt: string;
	date: Date;
	readingTime: string;
};

const projectModules = import.meta.glob('../_projects/*.{md,mdx}', { eager: true }) as Record<string, any>;
const postModules = import.meta.glob('../_posts/*.md', { eager: true }) as Record<string, any>;

const projects: ProjectItem[] = Object.entries(projectModules).map(([filePath, mod]) => {
	const fm = mod.frontmatter ?? {};
	return {
		slug: filePathToSlug(filePath),
		title: fm.title ?? 'Untitled Project',
		description: fm.summary ?? fm.description ?? '',
		tags: fm.tags ?? [],
		thumbnail: toAbsolutePath(fm.thumbnail ?? fm.image?.path),
		videoUrl: fm.videoUrl,
		date: toDate(fm.date),
		pinned: Boolean(fm.pinned),
		order: typeof fm.order === 'number' ? fm.order : undefined,
	};
});

const posts: PostItem[] = Object.entries(postModules).map(([filePath, mod]) => {
	const fm = mod.frontmatter ?? {};
	return {
		slug: filePathToSlug(filePath),
		title: fm.title ?? 'Untitled Post',
		excerpt: fm.excerpt ?? fm.summary ?? '',
		date: toDate(fm.date),
		readingTime: fm.readingTime ?? '5 min read',
	};
});

const FALLBACK_ORDER = Number.MAX_SAFE_INTEGER;
const featuredProjects = [...projects]
	.sort((a, b) => {
		const byOrder = (a.order ?? FALLBACK_ORDER) - (b.order ?? FALLBACK_ORDER);
		if (byOrder !== 0) return byOrder;

		const byPinned = Number(b.pinned) - Number(a.pinned);
		if (byPinned !== 0) return byPinned;

		return b.date.valueOf() - a.date.valueOf();
	})
	.slice(0, 6);

const heroProject = featuredProjects[0];
const latestPosts = [...posts].sort((a, b) => b.date.valueOf() - a.date.valueOf()).slice(0, 3);
---

<Layout>
	<main class="mx-auto w-full max-w-6xl px-4 pb-16 pt-8 md:px-8">
		<section class="hero-surface relative mb-12 w-screen overflow-hidden bg-gradient-to-r from-sky-100 via-violet-100 to-rose-100 py-12 text-slate-900 md:py-16 [margin-left:calc(50%-50vw)] [margin-right:calc(50%-50vw)]">
			<div class="hero-orb hero-orb-a pointer-events-none absolute -right-16 -top-20 h-56 w-56 rounded-full bg-sky-300/60 blur-3xl"></div>
			<div class="hero-orb hero-orb-b pointer-events-none absolute -bottom-20 left-12 h-64 w-64 rounded-full bg-violet-300/50 blur-3xl"></div>
			<div class="hero-orb hero-orb-c pointer-events-none absolute right-1/3 top-1/2 h-44 w-44 rounded-full bg-rose-300/35 blur-3xl"></div>
			<div class="relative mx-auto grid w-full max-w-6xl gap-8 px-4 md:grid-cols-[280px_1fr] md:items-center md:px-8">
				<div>
					<div class="w-fit rounded-3xl bg-white/65 p-2 shadow-lg backdrop-blur">
						<img
							src="/profile.png"
							alt="프로필 이미지"
							class="h-40 w-40 rounded-2xl bg-white object-cover md:h-52 md:w-52"
						/>
					</div>
					<!-- <p class="mt-4 max-w-xs text-sm leading-relaxed text-slate-700">
						운영 안정성을 해치지 않으면서도, 제품에 필요한 인터랙션과 실험을 빠르게 검증하는 개발 방식을 지향합니다.
					</p> -->
				</div>

				<div>
					<p class="mb-2 text-xs uppercase tracking-[0.18em] text-sky-700">Developer</p>
					<h1 class="mb-3 text-3xl font-extrabold leading-tight text-slate-900 md:text-5xl">
						서비스 개발부터 AI / 데이터 분석까지, 끊임없이 도전하는 엔지니어 <span class="text-sky-400">김태연</span> 입니다
					</h1>
					<div class="mt-5 flex flex-wrap gap-2">
						<span class="rounded-full border border-sky-300 bg-white/70 px-3 py-1 text-xs font-semibold text-sky-700 backdrop-blur">Frontend</span>
						<span class="rounded-full border border-violet-300 bg-white/70 px-3 py-1 text-xs font-semibold text-violet-700 backdrop-blur">Backend</span>
						<span class="rounded-full border border-rose-300 bg-white/70 px-3 py-1 text-xs font-semibold text-rose-700 backdrop-blur">AI Product</span>
					</div>
					<div class="mt-6 flex flex-wrap gap-3">
						<a href="/about" class="rounded-lg bg-slate-900 px-4 py-2 text-sm font-semibold text-white transition duration-200 hover:-translate-y-0.5 hover:bg-slate-800">About me</a>
						<a href="mailto:tae1344@gmail.com" class="rounded-lg border border-slate-300 bg-white/80 px-4 py-2 text-sm font-semibold text-slate-700 transition duration-200 hover:-translate-y-0.5 hover:bg-white">Email</a>
						<a href="https://github.com/tae1344" target="_blank" rel="noreferrer" class="rounded-lg border border-slate-300 bg-white/80 px-4 py-2 text-sm font-semibold text-slate-700 transition duration-200 hover:-translate-y-0.5 hover:bg-white">GitHub</a>
						<a href="https://fullmoon1344.tistory.com " class="rounded-lg border border-slate-300 bg-white/80 px-4 py-2 text-sm font-semibold text-slate-700 transition duration-200 hover:-translate-y-0.5 hover:bg-white">Blog</a>
					</div>
					<div class="mt-6 grid gap-2 text-sm text-slate-700 md:grid-cols-2">
						<p class="rounded-lg bg-white/70 px-3 py-2"><span class="font-semibold text-slate-900">경력:</span> {Math.floor((Date.now() - new Date('2021-02-01').getTime()) / (1000 * 60 * 60 * 24 * 365))}년</p>
						<p class="rounded-lg bg-white/70 px-3 py-2"><span class="font-semibold text-slate-900">전문:</span> React Native / Next.js</p>
						<p class="rounded-lg bg-white/70 px-3 py-2"><span class="font-semibold text-slate-900">관심 분야:</span> AI Product / Data / Fintech</p>
						<p class="rounded-lg bg-white/70 px-3 py-2"><span class="font-semibold text-slate-900">최근 이수:</span> SNU 빅데이터 핀테크 AI 고급 전문가 과정</p>
					</div>
				</div>
			</div>
		</section>

		<section id="featured-projects" class="mb-12">
			<div class="mb-5 flex items-end justify-between">
				<h2 class="text-2xl font-bold text-slate-900">Projects</h2>
				<a href="/projects" class="text-sm font-semibold text-sky-700 hover:text-sky-800">View All →</a>
			</div>
			<div class="grid gap-5 md:grid-cols-2 lg:grid-cols-3">
				{featuredProjects.map((project) => (
					<ProjectCard
						title={project.title}
						description={project.description}
						tags={project.tags}
						thumbnail={project.thumbnail || heroProject?.thumbnail || ''}
						videoUrl={project.videoUrl}
						href={`/projects/${project.slug}`}
					/>
				))}
			</div>
		</section>

		<section class="mb-12 grid gap-4 md:grid-cols-2">
			<a href="/about" class="rounded-2xl border border-sky-200 bg-gradient-to-br from-white to-sky-50 p-6 shadow-sm transition duration-200 hover:-translate-y-1 hover:shadow-md">
				<p class="mb-2 text-xs uppercase tracking-[0.14em] text-slate-500">Experience</p>
				<h3 class="mb-2 text-lg font-bold text-slate-900">(주)반려생활 Frontend Lead</h3>
				<p class="mb-4 text-sm text-slate-600">반려생활 앱/웹 프론트엔드 총괄, MAU 12만 성장 기여</p>
				<span class="text-sm font-semibold text-sky-700">자세히 보기 →</span>
			</a>
			<div class="rounded-2xl border border-violet-200 bg-gradient-to-br from-white to-violet-50 p-6 shadow-sm transition duration-200 hover:-translate-y-1 hover:shadow-md">
				<p class="mb-3 text-xs uppercase tracking-[0.14em] text-slate-500">Tech Stack</p>
				<div class="space-y-3">
					<div>
						<p class="mb-1 text-sm font-semibold text-slate-800">Language</p>
						<p class="text-sm text-slate-600">Python, JavaScript, TypeScript</p>
					</div>
					<div>
						<p class="mb-1 text-sm font-semibold text-slate-800">Framework</p>
						<p class="text-sm text-slate-600">React, Next.js, React Native, Expo, Tailwind CSS, Astro</p>
					</div>
					<div>
						<p class="mb-1 text-sm font-semibold text-slate-800">Database</p>
						<p class="text-sm text-slate-600">PostgreSQL, MongoDB, Qdrant, Redis</p>
					</div>
					<div>
						<p class="mb-1 text-sm font-semibold text-slate-800">Infrastructure</p>
						<p class="text-sm text-slate-600">Docker, Nginx, Cloudflare</p>
					</div>
					<div>
						<p class="mb-1 text-sm font-semibold text-slate-800">AI & Data</p>
						<p class="text-sm text-slate-600">RAG, Prompt Engineering, LLM, ML, DL, 3DGS</p>
					</div>
				</div>
			</div>
		</section>

		<section class="rounded-2xl border border-sky-200 bg-gradient-to-r from-sky-50 via-indigo-50 to-violet-50 p-7 text-center">
			<p class="mb-2 text-lg font-bold text-slate-900">협업이나 채용 관련 문의는 아래 이메일로 연락 부탁드립니다.</p>
			<a href="mailto:tae1344@gmail.com" class="inline-block rounded-lg bg-sky-700 px-5 py-2 text-sm font-semibold text-white hover:bg-sky-800">
				tae1344@gmail.com
			</a>
		</section>
	</main>
</Layout>

<style>
	.hero-surface::after {
		content: '';
		position: absolute;
		inset: 0;
		background-image: radial-gradient(circle at 1px 1px, rgba(51, 65, 85, 0.08) 1px, transparent 0);
		background-size: 24px 24px;
		pointer-events: none;
	}

	.hero-orb {
		animation: floatOrb 10s ease-in-out infinite;
	}

	.hero-orb-b {
		animation-delay: 1.2s;
	}

	.hero-orb-c {
		animation-delay: 2.4s;
	}

	@keyframes floatOrb {
		0%,
		100% {
			transform: translate3d(0, 0, 0) scale(1);
		}
		50% {
			transform: translate3d(0, -10px, 0) scale(1.05);
		}
	}
</style>
